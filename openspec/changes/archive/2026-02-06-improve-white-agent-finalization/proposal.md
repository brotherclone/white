# Change: Improve White Agent Finalization

## Problem Statement

The White agent's finalization (`finalize_song_proposal`, `_perform_meta_rebracketing`, `_generate_chromatic_synthesis`) produces outputs with a "similar feel" regardless of the rich, diverse content generated by the rainbow agents. The synthesis doesn't leverage the actual artifacts.

## Current Issues

### 1. Artifacts Are Ignored
The finalization prompts receive:
- Transformation traces (thin metadata: `boundaries_shifted`, `patterns_revealed`)
- Song proposal iterations (joined as strings)

But NOT:
- Extinction narratives (Green)
- Alternate timelines (Blue)
- Newspaper articles (Orange)
- Circle jerk interviews (Violet)
- EVP transcripts (Black)
- Last Human stories (Green)
- Infranym encodings (Indigo)

### 2. Static Agent Descriptions
The meta-rebracketing prompt lists all 7 agents with hardcoded boundary descriptions, regardless of which agents actually ran. If you stop after Orange, it still references Green/Blue/Indigo/Violet.

### 3. Document Synthesis Underutilized
Each `process_*_agent_work` method creates a `document_synthesis`, but these aren't aggregated into the final synthesis. They're processed individually then forgotten.

### 4. Generic Prompts
The synthesis prompts are identical every run:
- Same structure
- Same instructions
- Same output format

This produces structurally similar outputs even with wildly different input content.

### 5. Transformation Traces Are Too Thin
`TransformationTrace` captures:
```python
agent_name: str
iteration_id: str
boundaries_shifted: List[str]
patterns_revealed: List[str]
semantic_resonances: Dict[str, Any]
```

But not the actual *content* of what was transformed - no excerpts, no artifact summaries.

## Proposed Improvements

### Phase 1: Feed Artifacts Into Synthesis
- Add `_gather_artifact_summaries(state)` to extract key content from each artifact type
- Include artifact summaries in meta-rebracketing prompt
- Weight artifacts by agent that created them

### Phase 2: Dynamic Agent Context
- Only describe agents that actually ran (check `state.transformation_traces`)
- Include each agent's specific `document_synthesis`
- Reference actual boundaries shifted, not hardcoded ones

### Phase 3: Richer Transformation Traces
- Add optional `content_excerpt` field to `TransformationTrace`
- Capture 1-2 sentence summary of what each agent produced
- Include artifact counts per agent

### Phase 4: Varied Synthesis Prompts
- Create 3-4 synthesis prompt templates with different focuses:
  - Temporal (past/present/future emphasis)
  - Ontological (real/imagined/forgotten emphasis)
  - Emotional (tone/mood integration)
  - Structural (musical architecture focus)
- Select template based on dominant transformation patterns

### Phase 5: Per-Agent Synthesis Sections
- Generate mini-synthesis for each agent that ran
- Aggregate into unified document with clear attribution
- Preserve unique voice/methodology of each lens

## Impact

- Richer, more varied final outputs
- Better utilization of expensive LLM-generated content
- Clear traceability from artifacts â†’ synthesis
- Outputs that actually reflect the specific content generated

## Files Affected

- `app/agents/white_agent.py` (finalization methods)
- `app/structures/concepts/transformation_trace.py` (richer traces)
- Possibly new `app/agents/tools/synthesis_tools.py` for artifact gathering
