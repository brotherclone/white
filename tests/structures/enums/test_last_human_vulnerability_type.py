import enum
import pytest

from app.structures.enums.last_human_vulnerability_type import (
    LastHumanVulnerabilityType,
)

EXPECTED = {
    "DISPLACEMENT": "displacement",
    "RESOURCE_COLLAPSE": "resource_collapse",
    "TOXIC_EXPOSURE": "toxic_exposure",
    "CLIMATE_REFUGEE": "climate_refugee",
    "ECONOMIC_EXTINCTION": "economic_extinction",
    "HEALTH_CASCADE": "health_cascade",
    "ENTANGLEMENT": "entanglement",
    "ISOLATION": "isolation",
}


def test_members_and_values():
    assert set(LastHumanVulnerabilityType.__members__.keys()) == set(EXPECTED.keys())
    for name, expected_value in EXPECTED.items():
        member = getattr(LastHumanVulnerabilityType, name)
        assert member.value == expected_value
        assert isinstance(member.value, str)


def test_members_are_str_and_enum_and_compare_to_value():
    for member in LastHumanVulnerabilityType:
        assert isinstance(member, LastHumanVulnerabilityType)
        assert isinstance(member, str)
        assert isinstance(member, enum.Enum)
        assert member == member.value


@pytest.mark.parametrize(
    "value,member",
    [
        ("displacement", LastHumanVulnerabilityType.DISPLACEMENT),
        ("resource_collapse", LastHumanVulnerabilityType.RESOURCE_COLLAPSE),
        ("toxic_exposure", LastHumanVulnerabilityType.TOXIC_EXPOSURE),
        ("climate_refugee", LastHumanVulnerabilityType.CLIMATE_REFUGEE),
        ("economic_extinction", LastHumanVulnerabilityType.ECONOMIC_EXTINCTION),
        ("health_cascade", LastHumanVulnerabilityType.HEALTH_CASCADE),
        ("entanglement", LastHumanVulnerabilityType.ENTANGLEMENT),
        ("isolation", LastHumanVulnerabilityType.ISOLATION),
    ],
)
def test_lookup_by_value(value, member):
    assert LastHumanVulnerabilityType(value) is member


def test_lookup_by_name():
    assert (
        LastHumanVulnerabilityType["DISPLACEMENT"]
        is LastHumanVulnerabilityType.DISPLACEMENT
    )
    assert (
        LastHumanVulnerabilityType["CLIMATE_REFUGEE"]
        is LastHumanVulnerabilityType.CLIMATE_REFUGEE
    )


def test_invalid_value_raises_value_error():
    with pytest.raises(ValueError):
        LastHumanVulnerabilityType("invalid_type")


def test_values_are_unique():
    values = [m.value for m in LastHumanVulnerabilityType]
    assert len(values) == len(set(values))
